<div align="center">

# ğŸ  Homelab Kubernetes

### Production-grade Kubernetes on Proxmox with Talos Linux & GitOps

[![Talos](https://img.shields.io/badge/Talos-v1.11.5-orange?style=for-the-badge&logo=talos)](https://www.talos.dev/)
[![Kubernetes](https://img.shields.io/badge/Kubernetes-v1.34.2-326CE5?style=for-the-badge&logo=kubernetes&logoColor=white)](https://kubernetes.io/)
[![Flux](https://img.shields.io/badge/Flux-v0.36.0-5468FF?style=for-the-badge&logo=flux&logoColor=white)](https://fluxcd.io/)

</div>

---

## Table of Contents

- [Overview](#overview)
- [Architecture](#architecture)
  - [Infrastructure Layer](#infrastructure-layer)
  - [Kubernetes Cluster](#kubernetes-cluster)
  - [Networking](#networking)
  - [Storage](#storage)
- [GitOps & CI/CD](#gitops--cicd)
  - [Flux GitOps](#flux-gitops)
  - [Branch Protection](#branch-protection)
  - [Automated Testing](#automated-testing)
  - [Image Automation](#image-automation)
- [Security](#security)
- [Applications](#applications)
- [Repository Structure](#repository-structure)
- [Documentation](#documentation)

---

## Overview

This repository contains the complete Infrastructure as Code for a production-grade Kubernetes homelab. Every component is declaratively defined, version controlled, and automatically deployed via GitOps.

### Design Principles

- **Immutable Infrastructure** - Talos Linux provides an immutable, API-driven OS
- **GitOps Everything** - All changes flow through Git with full audit trail
- **Defense in Depth** - Multiple layers of security from OS to application
- **High Availability** - 3 control plane nodes with automated failover
- **Automated Operations** - Self-healing, auto-updates, auto-scaling

---

## Architecture

### Infrastructure Layer

The cluster runs on a 4-node Proxmox VE hypervisor cluster with Ceph distributed storage:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Physical Infrastructure                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      pve1       â”‚      pve2       â”‚      pve3       â”‚       pve4        â”‚
â”‚  Ryzen 9 6900HX â”‚  Ryzen 9 6900HX â”‚   Intel N150    â”‚  Intel i5-12500T  â”‚
â”‚      28GB       â”‚      28GB       â”‚      16GB       â”‚       64GB        â”‚
â”‚   Compute+Ceph  â”‚   Compute+Ceph  â”‚  Download+Ceph  â”‚    Media+GPU      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Ceph Storage    â”‚
                          â”‚   (Distributed)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Kubernetes Cluster

4 Talos Linux VMs form the Kubernetes cluster:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Talos Kubernetes Cluster                          â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Control Plane (HA)                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ talos-cp-1 â”‚  â”‚ talos-cp-2 â”‚  â”‚ talos-cp-3 â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ 172.16.1.50â”‚  â”‚ 172.16.1.51â”‚  â”‚ 172.16.1.52â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚  4c / 8GB  â”‚  â”‚  4c / 8GB  â”‚  â”‚  4c / 8GB  â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚        â”‚                â”‚               â”‚                         â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                         â”‚                                         â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚   â”‚
â”‚  â”‚              â”‚   Cluster VIP       â”‚                              â”‚   â”‚
â”‚  â”‚              â”‚   172.16.1.49:6443  â”‚                              â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       Worker Nodes                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚   â”‚
â”‚  â”‚  â”‚ talos-worker-1  â”‚                                             â”‚   â”‚
â”‚  â”‚  â”‚  172.16.1.53    â”‚                                             â”‚   â”‚
â”‚  â”‚  â”‚   8c / 16GB     â”‚                                             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Networking

Cilium provides advanced networking with eBPF:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Network Architecture                           â”‚
â”‚                                                                          â”‚
â”‚  External Traffic                                                        â”‚
â”‚        â”‚                                                                 â”‚
â”‚        â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Cilium    â”‚     â”‚   Envoy     â”‚     â”‚    Apps     â”‚                â”‚
â”‚  â”‚     L2      â”‚â”€â”€â”€â”€â–¶â”‚   Gateway   â”‚â”€â”€â”€â”€â–¶â”‚  (Pods)     â”‚                â”‚
â”‚  â”‚ Announcer   â”‚     â”‚  (Ingress)  â”‚     â”‚             â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                          â”‚
â”‚  LoadBalancer IPs:                                                       â”‚
â”‚  â”œâ”€â”€ 172.16.1.60  k8s-gateway (DNS)                                     â”‚
â”‚  â”œâ”€â”€ 172.16.1.61  envoy-internal (HTTPS)                                â”‚
â”‚  â””â”€â”€ 172.16.1.62  envoy-external (HTTPS)                                â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      DNS Architecture                            â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚   Client DNS Query (*.ragas.cc)                                  â”‚    â”‚
â”‚  â”‚          â”‚                                                       â”‚    â”‚
â”‚  â”‚          â–¼                                                       â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚   â”‚  AdGuard    â”‚â”€â”€â”€â–¶â”‚ k8s-gateway â”‚â”€â”€â”€â–¶â”‚   CoreDNS   â”‚         â”‚    â”‚
â”‚  â”‚   â”‚  (Router)   â”‚    â”‚ (Split DNS) â”‚    â”‚  (Cluster)  â”‚         â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Storage

Currently using local storage with plans for Ceph CSI:

| Type | Provider | Use Case |
|------|----------|----------|
| etcd | Local NVMe | Kubernetes state |
| Ephemeral | EmptyDir | Temporary data |
| Persistent | Ceph (planned) | Application data |

---

## GitOps & CI/CD

### Flux GitOps

All cluster state is managed through Flux GitOps:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GitOps Flow                                     â”‚
â”‚                                                                          â”‚
â”‚   Developer                                                              â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â”‚ git push                                                         â”‚
â”‚       â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    webhook    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    reconcile   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ GitHub  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    Flux     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Cluster â”‚  â”‚
â”‚   â”‚  Repo   â”‚               â”‚  Operator   â”‚                â”‚  State  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â”‚ notifies                            â”‚
â”‚                                    â–¼                                     â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                             â”‚   Discord   â”‚                              â”‚
â”‚                             â”‚   Webhook   â”‚                              â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Components:**
- **Source Controller** - Watches Git repositories
- **Kustomize Controller** - Applies Kustomizations
- **Helm Controller** - Manages HelmReleases
- **Notification Controller** - Sends alerts to Discord
- **Image Reflector** - Scans container registries
- **Image Automation** - Updates image tags automatically

### Branch Protection

The `main` branch is protected with strict rules:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Branch Protection                                 â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚   â”‚  Developer  â”‚                                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚          â”‚                                                               â”‚
â”‚          â”‚ Push to feature branch                                        â”‚
â”‚          â–¼                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚   Feature   â”‚â”€â”€â”€â”€â–¶â”‚  Create PR  â”‚â”€â”€â”€â”€â–¶â”‚   CI Runs   â”‚               â”‚
â”‚   â”‚   Branch    â”‚     â”‚   to main   â”‚     â”‚             â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                  â”‚                       â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                              â”‚                   â”‚                   â”‚   â”‚
â”‚                              â–¼                   â–¼                   â–¼   â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                       â”‚ YAML Lint â”‚       â”‚Kubeconformâ”‚       â”‚Flux Localâ”‚â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                   â”‚                  â”‚     â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                 â”‚                        â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                    â”‚                         â”‚           â”‚
â”‚                                 PASS                       FAIL          â”‚
â”‚                                    â”‚                         â”‚           â”‚
â”‚                                    â–¼                         â–¼           â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                             â”‚  Auto-merge â”‚          â”‚   Blocked   â”‚     â”‚
â”‚                             â”‚  to main    â”‚          â”‚   (Fix CI)  â”‚     â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â”‚   Protected Rules:                                                       â”‚
â”‚   âœ“ Required status checks (YAML Lint, Kubeconform, Flux Local)         â”‚
â”‚   âœ“ Enforce for administrators                                          â”‚
â”‚   âœ— Force pushes blocked                                                â”‚
â”‚   âœ— Branch deletion blocked                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Automated Testing

Every PR runs through comprehensive CI:

| Check | Tool | Purpose |
|-------|------|---------|
| **YAML Lint** | yamllint | Syntax and style validation |
| **Kubeconform** | kubeconform | Kubernetes schema validation |
| **Flux Local** | flux-local | Offline Flux validation |
| **Security Scan** | Trivy | Vulnerability detection |
| **Secret Scan** | Gitleaks | Credential leak prevention |

### Image Automation

Container images are automatically updated via Flux:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Image Automation Pipeline                           â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Container  â”‚    â”‚   Image     â”‚    â”‚   Image     â”‚                  â”‚
â”‚  â”‚  Registry   â”‚â”€â”€â”€â–¶â”‚  Reflector  â”‚â”€â”€â”€â–¶â”‚   Policy    â”‚                  â”‚
â”‚  â”‚(Docker,GHCR)â”‚    â”‚ (scan tags) â”‚    â”‚  (semver)   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                               â”‚                          â”‚
â”‚                                               â”‚ new version detected     â”‚
â”‚                                               â–¼                          â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                                        â”‚   Image     â”‚                   â”‚
â”‚                                        â”‚  Automation â”‚                   â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                               â”‚                          â”‚
â”‚                                               â”‚ push to branch           â”‚
â”‚                                               â–¼                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    flux-image-updates branch                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                      â”‚
â”‚                                   â”‚ GitHub Action                        â”‚
â”‚                                   â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Create PR to main                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                      â”‚
â”‚                                   â”‚ CI passes                            â”‚
â”‚                                   â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Auto-merge & Deploy                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚   Tracked Images:                                                        â”‚
â”‚   â”œâ”€â”€ ghcr.io/gethomepage/homepage  (>=0.9.0)                           â”‚
â”‚   â”œâ”€â”€ squidfunk/mkdocs-material     (9.x)                               â”‚
â”‚   â””â”€â”€ grafana/grafana               (>=11.0.0)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security

### Layers of Security

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Security Architecture                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Layer 1: OS Security (Talos Linux)                               â”‚    â”‚
â”‚  â”‚  â€¢ Immutable filesystem                                          â”‚    â”‚
â”‚  â”‚  â€¢ No SSH, no shell                                              â”‚    â”‚
â”‚  â”‚  â€¢ API-only management                                           â”‚    â”‚
â”‚  â”‚  â€¢ Minimal attack surface                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Layer 2: Network Security (Cilium)                               â”‚    â”‚
â”‚  â”‚  â€¢ eBPF-based network policies                                   â”‚    â”‚
â”‚  â”‚  â€¢ Encrypted pod-to-pod traffic (WireGuard)                      â”‚    â”‚
â”‚  â”‚  â€¢ L7 visibility and filtering                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Layer 3: Secret Management (SOPS + Age)                          â”‚    â”‚
â”‚  â”‚  â€¢ All secrets encrypted at rest in Git                          â”‚    â”‚
â”‚  â”‚  â€¢ Decrypted only in-cluster by Flux                             â”‚    â”‚
â”‚  â”‚  â€¢ Age key stored securely                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Layer 4: TLS Everywhere (cert-manager)                           â”‚    â”‚
â”‚  â”‚  â€¢ Let's Encrypt certificates                                    â”‚    â”‚
â”‚  â”‚  â€¢ Automatic renewal                                             â”‚    â”‚
â”‚  â”‚  â€¢ Wildcard cert for *.ragas.cc                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Layer 5: Git Security (Branch Protection)                        â”‚    â”‚
â”‚  â”‚  â€¢ Required CI checks                                            â”‚    â”‚
â”‚  â”‚  â€¢ No direct pushes                                              â”‚    â”‚
â”‚  â”‚  â€¢ Secret scanning                                               â”‚    â”‚
â”‚  â”‚  â€¢ Signed commits (optional)                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Applications

### Deployed Services

| Category | Service | URL | Description |
|----------|---------|-----|-------------|
| **Dashboard** | Homepage | [home.ragas.cc](https://home.ragas.cc) | Service dashboard with widgets |
| **Monitoring** | Grafana | [grafana.ragas.cc](https://grafana.ragas.cc) | Metrics visualization |
| **Monitoring** | Prometheus | [prometheus.ragas.cc](https://prometheus.ragas.cc) | Metrics collection |
| **Monitoring** | Alertmanager | [alertmanager.ragas.cc](https://alertmanager.ragas.cc) | Alert routing |
| **Docs** | MkDocs | [docs.ragas.cc](https://docs.ragas.cc) | This documentation |

### Core Infrastructure

| Component | Version | Purpose |
|-----------|---------|---------|
| Cilium | 1.18.4 | CNI, LoadBalancer, Network Policies |
| CoreDNS | 1.45.0 | Cluster DNS |
| cert-manager | 1.19.1 | TLS certificate management |
| Envoy Gateway | 1.6.1 | Gateway API ingress |
| Flux | 0.36.0 | GitOps operator |
| kube-prometheus-stack | 72.6.2 | Full monitoring stack |

---

## Repository Structure

```
k3s-homelab/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/           # GitHub Actions
â”‚   â”‚   â”œâ”€â”€ validate.yaml    # CI: lint, validate, test
â”‚   â”‚   â”œâ”€â”€ auto-merge.yaml  # Auto-merge Dependabot PRs
â”‚   â”‚   â”œâ”€â”€ flux-image-pr.yaml # Create PRs for image updates
â”‚   â”‚   â”œâ”€â”€ flux-diff.yaml   # Show Flux changes on PRs
â”‚   â”‚   â”œâ”€â”€ security.yaml    # Trivy + Gitleaks scanning
â”‚   â”‚   â”œâ”€â”€ labeler.yaml     # Auto-label PRs
â”‚   â”‚   â””â”€â”€ release-drafter.yaml # Generate release notes
â”‚   â”œâ”€â”€ dependabot.yaml      # Dependabot config
â”‚   â””â”€â”€ labeler.yaml         # Label rules
â”œâ”€â”€ .githooks/
â”‚   â””â”€â”€ pre-push             # Local validation hook
â”œâ”€â”€ kubernetes/
â”‚   â”œâ”€â”€ apps/                # Application deployments
â”‚   â”‚   â”œâ”€â”€ cert-manager/    # TLS certificates
â”‚   â”‚   â”œâ”€â”€ default/         # User applications
â”‚   â”‚   â”‚   â”œâ”€â”€ homepage/    # Dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ mkdocs/      # Documentation
â”‚   â”‚   â”‚   â””â”€â”€ echo/        # Test app
â”‚   â”‚   â”œâ”€â”€ flux-system/     # GitOps components
â”‚   â”‚   â”‚   â”œâ”€â”€ flux-operator/
â”‚   â”‚   â”‚   â”œâ”€â”€ flux-instance/
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/  # Discord alerts
â”‚   â”‚   â”‚   â””â”€â”€ image-automation/ # Auto-update images
â”‚   â”‚   â”œâ”€â”€ kube-system/     # Core services
â”‚   â”‚   â”‚   â”œâ”€â”€ cilium/      # CNI
â”‚   â”‚   â”‚   â”œâ”€â”€ coredns/     # DNS
â”‚   â”‚   â”‚   â”œâ”€â”€ metrics-server/
â”‚   â”‚   â”‚   â”œâ”€â”€ reloader/
â”‚   â”‚   â”‚   â””â”€â”€ spegel/      # Image cache
â”‚   â”‚   â”œâ”€â”€ monitoring/      # Observability
â”‚   â”‚   â”‚   â””â”€â”€ kube-prometheus-stack/
â”‚   â”‚   â””â”€â”€ network/         # Ingress & DNS
â”‚   â”‚       â”œâ”€â”€ envoy-gateway/
â”‚   â”‚       â””â”€â”€ k8s-gateway/
â”‚   â”œâ”€â”€ components/          # Shared Kustomize components
â”‚   â”‚   â””â”€â”€ sops/            # SOPS decryption
â”‚   â””â”€â”€ flux/                # Flux bootstrap
â”‚       â””â”€â”€ cluster/
â”œâ”€â”€ talos/                   # Talos machine configs
â”‚   â”œâ”€â”€ talconfig.yaml       # Cluster definition
â”‚   â”œâ”€â”€ talsecret.sops.yaml  # Encrypted secrets
â”‚   â””â”€â”€ clusterconfig/       # Generated configs
â”œâ”€â”€ docs/                    # MkDocs documentation
â”‚   â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ guides/
â”‚   â””â”€â”€ runbooks/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup-hooks.sh       # Git hooks setup
â”œâ”€â”€ .pre-commit-config.yaml  # Pre-commit hooks
â”œâ”€â”€ .yamllint.yaml           # YAML linting rules
â”œâ”€â”€ .sops.yaml               # SOPS encryption config
â””â”€â”€ mkdocs.yml               # Documentation config
```

---

## Documentation

Comprehensive documentation is available at [docs.ragas.cc](https://docs.ragas.cc):

| Section | Description |
|---------|-------------|
| **[Architecture](docs/architecture/)** | System design, networking, storage, security, CI/CD |
| **[Services](docs/services/)** | Configuration guides for each deployed service |
| **[Guides](docs/guides/)** | How-to guides for common operations |
| **[Runbooks](docs/runbooks/)** | Incident response procedures |

---

## Acknowledgments

This project builds on the work of:

- [onedr0p/cluster-template](https://github.com/onedr0p/cluster-template) - GitOps patterns
- [Talos Linux](https://www.talos.dev/) - Secure Kubernetes OS
- [Flux](https://fluxcd.io/) - GitOps toolkit
- [Cilium](https://cilium.io/) - eBPF networking

---

<div align="center">

**[Documentation](https://docs.ragas.cc)** Â· **[GitHub](https://github.com/sagaragas/k3s-homelab)**

</div>
