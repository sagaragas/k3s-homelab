---
fail_fast: false
repos:
  # General hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-added-large-files
        args: [--maxkb=2048]
      - id: check-merge-conflict
      - id: check-yaml
        args: [--unsafe]
        exclude: ^(kubernetes/.*\.sops\.ya?ml|talos/.*\.ya?ml)$
      - id: detect-private-key
        exclude: ^talos/.*\.ya?ml$

  # YAML formatting
  - repo: https://github.com/macisamuele/language-formatters-pre-commit-hooks
    rev: v2.14.0
    hooks:
      - id: pretty-format-yaml
        args: [--autofix, --indent=2]
        exclude: ^(kubernetes/.*\.sops\.ya?ml|talos/.*|\.mise\.toml)

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        args: [-c, .yamllint.yaml]
        exclude: ^(talos/.*|\.sops\.ya?ml)$

  # SOPS encryption check
  - repo: https://github.com/k8s-at-home/sops-pre-commit
    rev: v2.1.1
    hooks:
      - id: forbid-secrets
        exclude: ^(talos/talsecret\.sops\.ya?ml)$

  # Kubernetes manifest validation
  - repo: https://github.com/yannh/kubeconform
    rev: v0.6.7
    hooks:
      - id: kubeconform
        args:
          - -strict
          - -ignore-missing-schemas
          - -skip=Secret,SopsSecret
          - -kubernetes-version=1.34.0
        files: ^kubernetes/.*\.ya?ml$
        exclude: ^(kubernetes/.*\.sops\.ya?ml|kubernetes/.*kustomization\.ya?ml)$

  # Shell script linting
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1
    hooks:
      - id: shellcheck
        args: [--severity=warning]

  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.43.0
    hooks:
      - id: markdownlint
        args: [--fix, --disable, MD013, MD033, MD041, --]
